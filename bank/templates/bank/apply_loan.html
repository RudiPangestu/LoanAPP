{% extends 'bank/base.html' %}
{% load crispy_forms_tags %}

{% block title %}Apply for a Loan - SecureBank{% endblock %}

{% block content %}
<!-- Loan Application Section -->
<section class="bg-bank py-5">
    <style>
        .form-group {
            margin-bottom: 1.5rem;
        }
        .form-section {
            margin-bottom: 2rem;
        }
        .d-none {
            display: none;
        }
        </style>
        
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8 text-center text-white">
                <h1 class="display-5 fw-bold mb-3">Loan Application</h1>
                <p class="lead mb-5">Complete the form below to apply for a loan. Our model will predict whether is approved or rejected </p>
        </div>
        
        <div class="row justify-content-center">
            <div class="col-lg-9">
                <div class="form-section ">
                    <form method="post" id="loan-application-form">
                        {% csrf_token %}
                    
                        <!-- Section 1: Personal Information -->
                        <div class="form-section" id="section-1">
                            <h4>Personal Information</h4>
                    
                            <div class="form-group">
                                <label for="{{ form.no_of_dependents.id_for_label }}">Number of Dependents</label>
                                {{ form.no_of_dependents }}
                            </div>
                            <div class="form-group">
                                <label for="{{ form.education.id_for_label }}">Education</label>
                                {{ form.education }}
                            </div>
                            <div class="form-group">
                                <label for="{{ form.self_employed.id_for_label }}">Are you Self-employed?</label>
                                {{ form.self_employed }}
                            </div>
                            <div class="form-group">
                                <label for="{{ form.income_annum.id_for_label }}">Annual Income ($)</label>
                                {{ form.income_annum }}
                            </div>
                    
                            <button type="button" class="btn btn-primary next-btn" data-next="section-2">Next</button>
                        </div>
                    
                        <!-- Section 2: Loan Details -->
                        <div class="form-section d-none" id="section-2">
                            <h4>Loan Details</h4>
                    
                            <div class="form-group">
                                <label for="{{ form.loan_amount.id_for_label }}">Loan Amount ($)</label>
                                {{ form.loan_amount }}
                            </div>
                            <div class="form-group">
                                <label for="{{ form.loan_term.id_for_label }}">Loan Term (Years)</label>
                                {{ form.loan_term }}
                            </div>
                            <div class="form-group">
                                <label for="{{ form.cibil_score.id_for_label }}">CIBIL Score (300-900)</label>
                                {{ form.cibil_score }}
                            </div>
                    
                            <button type="button" class="btn btn-primary prev-btn" data-prev="section-1">Back</button>
                            <button type="button" class="btn btn-primary next-btn" data-next="section-3">Next</button>
                        </div>
                    
                        <!-- Section 3: Asset Information -->
                        <div class="form-section d-none" id="section-3">
                            <h4>Asset Information</h4>
                    
                            <div class="form-group">
                                <label for="{{ form.residential_assets_value.id_for_label }}">Value of Residential Assets ($)</label>
                                {{ form.residential_assets_value }}
                            </div>
                            <div class="form-group">
                                <label for="{{ form.commercial_assets_value.id_for_label }}">Value of Commercial Assets ($)</label>
                                {{ form.commercial_assets_value }}
                            </div>
                            <div class="form-group">
                                <label for="{{ form.luxury_assets_value.id_for_label }}">Value of Luxury Assets ($)</label>
                                {{ form.luxury_assets_value }}
                            </div>
                            <div class="form-group">
                                <label for="{{ form.bank_asset_value.id_for_label }}">Value of Bank Assets ($)</label>
                                {{ form.bank_asset_value }}
                            </div>
                    
                            <button type="button" class="btn btn-primary prev-btn" data-prev="section-2">Back</button>
                            <button type="submit" class="btn btn-success">Submit Application</button>
                        </div>
                    </form>
                    
                    
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Application Process Section -->
<section class="py-5 bg-white">
    <div class="container">
        <div class="row justify-content-center mb-5">
            <div class="col-lg-8 text-center">
                <h2 class="section-title text-center">Our Loan Application Process</h2>
                <p class="text-muted">We've made applying for a loan as simple and straightforward as possible. Here's what to expect:</p>
            </div>
        </div>
        
        <div class="row">
            <div class="col-md-3 mb-4">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="card-body text-center p-4">
                        <div class="rounded-circle bg-primary text-white d-inline-flex align-items-center justify-content-center mb-4" style="width: 70px; height: 70px;">
                            <i class="fas fa-file-alt fa-2x"></i>
                        </div>
                        <h4>1. Apply</h4>
                        <p class="text-muted">Complete the application form with your personal and financial details.</p>
                    </div>
                </div>
            </div>
            
            <div class="col-md-3 mb-4">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="card-body text-center p-4">
                        <div class="rounded-circle bg-primary text-white d-inline-flex align-items-center justify-content-center mb-4" style="width: 70px; height: 70px;">
                            <i class="fas fa-search-dollar fa-2x"></i>
                        </div>
                        <h4>2. Review</h4>
                        <p class="text-muted">Our team reviews your application and credit information.</p>
                    </div>
                </div>
            </div>
            
            <div class="col-md-3 mb-4">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="card-body text-center p-4">
                        <div class="rounded-circle bg-primary text-white d-inline-flex align-items-center justify-content-center mb-4" style="width: 70px; height: 70px;">
                            <i class="fas fa-check-circle fa-2x"></i>
                        </div>
                        <h4>3. Approval</h4>
                        <p class="text-muted">Receive your loan decision within 24 hours of applying.</p>
                    </div>
                </div>
            </div>
            
            <div class="col-md-3 mb-4">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="card-body text-center p-4">
                        <div class="rounded-circle bg-primary text-white d-inline-flex align-items-center justify-content-center mb-4" style="width: 70px; height: 70px;">
                            <i class="fas fa-money-check-alt fa-2x"></i>
                        </div>
                        <h4>4. Funding</h4>
                        <p class="text-muted">Get your loan funds deposited directly into your account.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- FAQ Section -->
<section class="py-5 bg-light">
    <div class="container">
        <div class="row justify-content-center mb-5">
            <div class="col-lg-8 text-center">
                <h2 class="section-title text-center">Frequently Asked Questions</h2>
                <p class="text-muted">Find answers to common questions about our loan application process.</p>
            </div>
        </div>
        
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="accordion" id="loanFaq">
                    <div class="accordion-item border mb-3 rounded shadow-sm">
                        <h2 class="accordion-header" id="heading1">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapse1" aria-expanded="true" aria-controls="collapse1">
                                What factors affect my loan approval?
                            </button>
                        </h2>
                        <div id="collapse1" class="accordion-collapse collapse show" aria-labelledby="heading1" data-bs-parent="#loanFaq">
                            <div class="accordion-body">
                                Several factors affect loan approval, including your credit score, income, existing debt, employment history, and the value of your assets. We look at your overall financial situation to determine your ability to repay the loan.
                            </div>
                        </div>
                    </div>
                    
                    <div class="accordion-item border mb-3 rounded shadow-sm">
                        <h2 class="accordion-header" id="heading2">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse2" aria-expanded="false" aria-controls="collapse2">
                                How long does the approval process take?
                            </button>
                        </h2>
                        <div id="collapse2" class="accordion-collapse collapse" aria-labelledby="heading2" data-bs-parent="#loanFaq">
                            <div class="accordion-body">
                                Most loan applications are processed within 24 hours. After approval, funds can be deposited in your account within 1-3 business days, depending on your bank.
                            </div>
                        </div>
                    </div>
                    
                    <div class="accordion-item border mb-3 rounded shadow-sm">
                        <h2 class="accordion-header" id="heading3">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse3" aria-expanded="false" aria-controls="collapse3">
                                What is a CIBIL score and why is it important?
                            </button>
                        </h2>
                        <div id="collapse3" class="accordion-collapse collapse" aria-labelledby="heading3" data-bs-parent="#loanFaq">
                            <div class="accordion-body">
                                CIBIL score is a three-digit number (ranging from 300 to 900) that represents your creditworthiness. It's based on your credit history and is important because lenders use it to evaluate the risk of lending money to you. A higher score increases your chances of loan approval with better terms.
                            </div>
                        </div>
                    </div>
                    
                    <div class="accordion-item border mb-3 rounded shadow-sm">
                        <h2 class="accordion-header" id="heading4">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse4" aria-expanded="false" aria-controls="collapse4">
                                Can I apply if I have a low credit score?
                            </button>
                        </h2>
                        <div id="collapse4" class="accordion-collapse collapse" aria-labelledby="heading4" data-bs-parent="#loanFaq">
                            <div class="accordion-body">
                                Yes, you can still apply. While a good credit score (700+) improves your chances of approval, we consider multiple factors including your income, assets, and employment history. However, a lower credit score may result in higher interest rates or require additional security.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const nextButtons = document.querySelectorAll('.next-btn');
            const prevButtons = document.querySelectorAll('.prev-btn');
        
            nextButtons.forEach(btn => {
                btn.addEventListener('click', function () {
                    const current = this.closest('.form-section');
                    const next = document.getElementById(this.dataset.next);
                    current.classList.add('d-none');
                    next.classList.remove('d-none');
                });
            });
        
            prevButtons.forEach(btn => {
                btn.addEventListener('click', function () {
                    const current = this.closest('.form-section');
                    const prev = document.getElementById(this.dataset.prev);
                    current.classList.add('d-none');
                    prev.classList.remove('d-none');
                });
            });
        });
    </script>
        
</section>
{% endblock %}